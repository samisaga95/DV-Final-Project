<!DOCTYPE html>
<meta charset="utf-8" />
<html>
  <head>
    <style>
      .one {
        background: #1f77b4;
      }

      .two {
        background: #2ca02c;
      }

      .three {
        background: #ff7f0e;
      }

      .four {
        background: #ff4500;
      }

      .five {
        background: #ffa500;
      }

      .ltext {
        float: left;
        width: calc(100% - 20px);
      }

      .lcolor {
        width: 10px;
        height: 10px;
        border-radius: 3px;
        float: left;
        margin: 5px 0 5px 10px;
      }

      .lrow {
        background: white;
      }

      .legends {
        position: absolute;
        width: 100px;
        right: 10%;
        top: 30%;
      }

      .slider-wrap {
        position: relative;
      }

      .left {
        width: 40px;
        height: 40px;
        position: absolute;
        background: red;
        left: 0;
        top: 50%;
        z-index: 1000;
        border-radius: 20px;
      }

      .right {
        width: 40px;
        height: 40px;
        position: absolute;
        background: red;
        right: 0;
        top: 50%;
        z-index: 1000;
        border-radius: 20px;
      }

      .slider-container {
        overflow-x: scroll;
      }

      #Tchart {
        position: relative;
        right: 0;
      }
    </style>

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./bar_style.css" />
    <link rel="stylesheet" href="./styles.css" />
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"
    ></script>
    <script src="http://d3js.org/d3.v3.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment.min.js"></script>
  </head>
  <body onload="incrementCount(41130000)">
    <div class="bar">
      <div class="inner_bar">
        <img class="logo" src="./Amazon-Logo.jpg" />
        <a class="header-text h1">ReviewHub</a>
      </div>

      <!-- </div> -->
    </div>
    <div class="container page-wrapper">
      <div class="row total-reviews-wrapper">
        <div class="total-reviews">
          <div class="total-numbers" id="display_div_id"></div>
          <h4>Total Reviews:</h4>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-6 heat-map-wrapper">
          <h3 class="prod-header">Product Categories</h3>
          <div class="dataset-picker" id="dataset-picker"></div>
          <div class="row">
            <div class="col-sm-12" id="chart"></div>
          </div>
        </div>

        <div class="col-sm-6 second-column-wrapper">
          <h3 style="padding: 10px 15px;">Category Analysis</h3>
          <div class="col-sm-12 heat-map-hover" id="table"></div>
          <h3 class="heading">Rating Distribution</h3>
          <div class="set-picker" id="set-picker"></div>
          <div id="graphic"></div>
        </div>
      </div>
      <div class="row">
        <h3 class="helpful-heading">Top Helpful Reviews</h3>
        <div class="review-wrapper">
          <div class="review-container1 row"></div>
          <p class="read-more">
            <span id="more" class="button">Read full Reviews</span>
          </p>
        </div>
      </div>
      <div class="row">
        <div class="timeseries-wrapper" style="position:relative;">
          <h3>Time series data</h3>
          <div id="controllers"></div>

          <div class="slider-wrap">
            <!-- <div class="left"></div> -->
            <div class="slider-container">
              <div id="Tchart"></div>
            </div>
            <!-- <div class="right"></div> -->
          </div>
          <div class="legends clearfix">
            <div class="lrow clearfix">
              <div class="lcolor five"></div>
              <div class="ltext">Rating 5</div>
            </div>
            <div class="lrow clearfix">
              <div class="lcolor four"></div>
              <div class="ltext">Rating 4</div>
            </div>
            <div class="lrow clearfix">
              <div class="lcolor three"></div>
              <div class="ltext">Rating 3</div>
            </div>
            <div class="lrow clearfix">
              <div class="lcolor two"></div>
              <div class="ltext">Rating 2</div>
            </div>
            <div class="lrow clearfix">
              <div class="lcolor one"></div>
              <div class="ltext">Rating 1</div>
            </div>
          </div>

          <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment.min.js"></script>
          <script src="./script.js"></script>
        </div>
      </div>
      <div class="row">
        <div class="second-column-wrapper col-sm-6">
          <h3 class="heading">Sentiment Analysis</h3>
          <div style="text-align:center" id="svgcontainer1"></div>
        </div>
        <div class="heat-map-wrapper col-sm-6">
          <h3 class="heading">Context Based Reviews</h3>
          <div
            class="review-container"
            style="height: 600px;
          overflow-y: auto;"
          ></div>
        </div>
      </div>
    </div>
    <script>
      var $el,
        $ps,
        $up,
        totalHeight,
        reviewNumber = 3,
        maxHeight,
        moreText,
        flag = 0;
      var loadHelpfulReviews = function loadHelpfulReviews(rating) {
        var filename = "../Dataset/UsefulRev/help_" + selectedDept + "_5.json";
        //var filename = "help_Musical_Instruments_5.json";

        $("#more").html("Read full Reviews");
        $(".review-wrapper").css("height", "300px");
        flag = 0;
        $.getJSON(filename, function(data) {
          var data = data;

          //var reviewNumber = rating.Category.charAt(0) || 3;
          var topReviews = "review_" + 3;
          var productIDS = "product_" + 3;
          var score = "score_" + 3;
          var selectedData = data[0];
          //console.log(selectedData[topReviews]);
          var wordObj = {
            reviews: selectedData[topReviews],
            productId: selectedData[productIDS],
            helpful: selectedData[score]
          };
          if (rating) {
            reviewNumber = rating.Category.charAt(0) || 3;
            topReviews = "review_" + reviewNumber;
            productIDS = "product_" + reviewNumber;
            score = "score_" + reviewNumber;
            var wordObj = {
              reviews: selectedData[topReviews],
              productId: selectedData[productIDS],
              helpful: selectedData[score]
            };
          }

          $(".helpful-heading").html(
            "Top Helpful Reviews for Rating #" + reviewNumber
          );
          $(".review-container1").html("");
          $.each(wordObj.reviews, function(key, val) {
            var card =
              "<div class='col-sm-3' style='padding: 0px 5px;'" +
              "<div class='card col-sm-12''><div class='card-body' style='width: 100%;margin : 0.5rem 0;background-color: #ffba00;color:black;'>" +
              "<h5 class='card-title' style='font-weight: bold;'>" +
              wordObj.productId[key] +
              "</h5>" +
              // "<h6 class='card-subtitle mt-1 mb-2'>Helpful Rating: " +
              // wordObj.helpful[key] +
              // "</h6>"+
              "<p class='card-text'>" +
              val +
              "</p></div></div></div>";
            $(".review-container1").append(card);
          });
        });
      };

      $("body").on("click", ".read-more", function(e) {
        console.log(e);
        e.stopPropagation();
        e.preventDefault();
        totalHeight = 0;
        maxHeight = 0;

        $el = $(this).find("span");
        $p = $(this);
        moreText = $el.html();
        //read-more
        $up = $p.parent();
        //review-wrapper(up)
        var arr = $up.find("p:not('.read-more')");

        if (moreText == "Read full Reviews" && flag == 0) {
          flag = 1;
          // measure how tall inside should be by adding together heights of all inside paragraphs (except read-more paragraph)
          for (var i = 0; i < arr.length; i++) {
            if (maxHeight < arr[i].offsetHeight) {
              maxHeight = arr[i].offsetHeight;
            }
          }
          totalHeight = maxHeight + 120;

          $up
            .css({
              // Set height to prevent instant jumpdown when max height is removed
              //"height": $up.height(),
              height: totalHeight,
              "max-height": 9999
            })
            .animate({
              height: totalHeight
            });
          $el.html("See Less");
          // fade out read-more
          //$p.fadeOut('slow');
          $p.fadeTo(1000, 1);
          return false;
        } else if (moreText == "See Less" && flag == 1) {
          flag = 0;
          $up
            .css({
              // Set height to prevent instant jumpdown when max height is removed
              //"height": $up.height(),
              height: $up.height(),
              "max-height": 300
            })
            .animate({
              height: $up.height()
            });
          // fade out read-more
          //$p.fadeOut('slow');
          $p.fadeTo(1000, 1);
          $el.html("Read full Reviews");
          return false;
        }
      });
    </script>
    <script>
      var width = 520,
        height = 500,
        padding = 1.5, // separation between same-color nodes
        clusterPadding = 6, // separation between different-color nodes
        maxRadius = 50;

      //
      //         data1 = data;
      //         console.log(data);
      //         bubbleDisplay();
      //     });
      var loadBubbleGraph = function(categoryName) {
        var filename =
          "../Dataset/BubbleChartData/output_" + categoryName + "_5.json";
        // var filename = "new 7.json";
        var onClick = function(d) {
          selectedWord = d.text;

          d3.select("#svgcontainer1")
            .select("svg")
            .selectAll("text")
            .attr("stroke", function(d) {
              if (d.text == selectedWord) {
                return "#fff";
              } else {
                return "black";
              }
            })
            .attr("fill", function(d) {
              if (d.text == selectedWord) {
                return "#fff";
              } else {
                return "black";
              }
            });

          // d3.select("#svgcontainer1")
          // .select("svg")
          // .selectAll("text")
          // .attr("stroke", "black");

          $(".review-container").html("");
          $.each(d.reviews, function(key, val) {
            console.log(d);
            var card =
              "<div class='card' style='width: 100%;margin : 0.5rem 0;background-color: #ffba00;'><div class='card-body'><h5 class='card-title' style='font-weight: bold;'>" +
              d.productId[key] +
              "</h5>" +
              // "<h6 class='card-subtitle mb-2'>Rating: " +
              // d.rating[key] +
              // "</h6>"+
              "<p class='card-text'>" +
              val +
              "</p></div></div>";
            $(".review-container").append(card);
          });
        };
        var width = 600,
          height = 600,
          padding = 1.5, // separation between same-color nodes
          clusterPadding = 6, // separation between different-color nodes
          maxRadius = 50;

        d3.select("#svgcontainer1")
          .selectAll("svg")
          .remove();

        $.getJSON(filename, function(data) {
          var data = data;
          var maxfreq = 0;
          var selectedWord = data[0].word;
          var wordObj = {
            cluster: 0,
            sentiment: data[0].sentiment,
            reviews: data[0].topReviews,
            productId: data[0].productIDS,
            radius: data[0].frequency * 1,
            text: data[0].word,
            // rating: data[0].ratings,
            productIDS: data[0].productIDS,
            x: 0,
            y: 0
          };
          onClick(wordObj);

          data.forEach(function(d) {
            if (d.frequency > maxfreq) {
              maxfreq = d.frequency;
            }
            d.frequency = +d.frequency;
          });

          //unique cluster/group id's
          var cs = [];
          data.forEach(function(d) {
            if (d.sentiment < -0.5) {
              var sent = 1;
            } else if (d.sentiment >= -0.5 && d.sentiment < 0) {
              var sent = 2;
            } else if (d.sentiment == 0) {
              var sent = 3;
            } else if (d.sentiment >= 0 && d.sentiment < 0.5) {
              var sent = 4;
            } else {
              var sent = 5;
            }
            if (!cs.contains(sent)) {
              cs.push(sent);
            }
          });

          var n = data.length, // total number of nodes
            m = cs.length; // number of distinct clusters

          //create clusters and nodes
          var clusters = new Array(m);
          var nodes = [];
          for (var i = 0; i < n; i++) {
            nodes.push(create_nodes(data, i));
          }

          var force = d3.layout
            .force()
            .nodes(nodes)
            .size([width, height])
            .gravity(0.02)
            .charge(0)
            .on("tick", tick)
            .start();

          var svg = d3
            .select("#svgcontainer1")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

          var node = svg
            .selectAll("circle")
            .data(nodes)
            .enter()
            .append("g");

          node
            .append("circle")
            .attr("cursor", "pointer")
            .style("fill", function(d) {
              if (parseFloat(d.sentiment) < parseFloat(-0.5)) {
                return "rgb(255,0,0)";
              } else if (
                parseFloat(d.sentiment) >= -0.5 &&
                parseFloat(d.sentiment) < 0
              ) {
                return "rgb(255,146,141)";
              } else if (parseFloat(d.sentiment) == 0) {
                return "rgb(255,165,0)";
              } else if (
                parseFloat(d.sentiment) >= 0 &&
                parseFloat(d.sentiment) < 0.5
              ) {
                return "rgb(145,192,139)";
              } else {
                return "rgb(0,128,0)";
              }
            })
            .attr("r", function(d) {
              return d.radius;
            });

          node
            .append("text")
            .attr("dy", ".3em")
            .attr("cursor", "pointer")
            .attr("stroke", function(d) {
              if (d.text == selectedWord) {
                return "#fff";
              } else {
                return "black";
              }
            })
            .attr("fill", function(d) {
              if (d.text == selectedWord) {
                return "#fff";
              } else {
                return "black";
              }
            })
            .attr("font-weight", function(d) {
              if (d.text == selectedWord) {
                return "700";
              } else {
                return "300";
              }
            })
            .style("text-anchor", "middle")
            .text(function(d) {
              return d.text;
            });

          node.on("click", function(d) {
            onClick(d);
          });

          function create_nodes(data, node_counter) {
            var multiplier = width / (maxfreq * 7);
            console.log("Multiplier", multiplier);

            var i = cs.indexOf(data[node_counter].group),
              r =
                Math.sqrt(((i + 1) / m) * -Math.log(Math.random())) * maxRadius,
              d = {
                cluster: i,
                sentiment: data[node_counter].sentiment,
                reviews: data[node_counter].topReviews,
                radius: data[node_counter].frequency * multiplier,
                text: data[node_counter].word,
                // rating: data[node_counter].ratings,
                productId: data[node_counter].productIDS,
                x:
                  Math.cos((i / m) * 2 * Math.PI) * 200 +
                  width / 2 +
                  Math.random(),
                y:
                  Math.sin((i / m) * 2 * Math.PI) * 200 +
                  height / 2 +
                  Math.random()
              };
            if (!clusters[i] || r > clusters[i].radius) clusters[i] = d;
            return d;
          }

          function tick(e) {
            node
              .each(cluster(10 * e.alpha * e.alpha))
              .each(collide(0.5))
              .attr("transform", function(d) {
                var k = "translate(" + d.x + "," + d.y + ")";
                return k;
              });
          }

          // Move d to be adjacent to the cluster node.
          function cluster(alpha) {
            return function(d) {
              var cluster = clusters[d.cluster];
              if (cluster === d) return;
              var x = d.x - cluster.x,
                y = d.y - cluster.y,
                l = Math.sqrt(x * x + y * y),
                r = d.radius + cluster.radius;
              if (l != r) {
                l = ((l - r) / l) * alpha;
                d.x -= x *= l;
                d.y -= y *= l;
                cluster.x += x;
                cluster.y += y;
              }
            };
          }

          // Resolves collisions between d and all other circles.
          function collide(alpha) {
            var quadtree = d3.geom.quadtree(nodes);
            return function(d) {
              var r = d.radius + maxRadius + Math.max(padding, clusterPadding),
                nx1 = d.x - r,
                nx2 = d.x + r,
                ny1 = d.y - r,
                ny2 = d.y + r;
              quadtree.visit(function(quad, x1, y1, x2, y2) {
                if (quad.point && quad.point !== d) {
                  var x = d.x - quad.point.x,
                    y = d.y - quad.point.y,
                    l = Math.sqrt(x * x + y * y),
                    r =
                      d.radius +
                      quad.point.radius +
                      (d.cluster === quad.point.cluster
                        ? padding
                        : clusterPadding);
                  if (l < r) {
                    l = ((l - r) / l) * alpha;
                    d.x -= x *= l;
                    d.y -= y *= l;
                    quad.point.x += x;
                    quad.point.y += y;
                  }
                }
                return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
              });
            };
          }
        });

        Array.prototype.contains = function(v) {
          for (var i = 0; i < this.length; i++) {
            if (this[i] === v) return true;
          }
          return false;
        };
      };
    </script>

    <script type="text/javascript">
      var selected = "Percentage";
      var selectedDept = "Health_and_Personal_Care";

      var margin = { top: 50, right: 0, bottom: 100, left: 50 },
        width = 960 - margin.left - margin.right,
        height = 600 - margin.top - margin.bottom,
        gridSize = Math.floor(width / 13),
        buckets = 10,
        colors = [
          "#ffffff",
          "#cccccc",
          "#999",
          "#666",
          "#333",
          "#1d91c0",
          "#225ea8",
          "#253494",
          "#081d58"
        ], // alternatively colorbrewer.YlGnBu[9]
        textColors = [
          "#333",
          "#333",
          "#111",
          "#fff",
          "#fff",
          "#333",
          "#333",
          "#333",
          "#fff"
        ],
        dataset = [
          ["Total Reviews", "./dataTotal.csv"],
          ["Average of Ratings", "./dataAverage.csv"],
          ["Alphabetical Order", "./dataName.csv"]
        ];

      var svg = d3
        .select("#chart")
        .append("svg")
        .attr("width", gridSize * 1.75 * 4 + margin.left + margin.right)
        .attr("height", gridSize * 6 + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var heatmapChart = function(csvFile) {
        svg.selectAll(".column").remove();

        d3.csv(csvFile, function(error, data) {
          //for color scale
          var colorScale = d3.scale
            .quantile()
            .domain([
              d3.min(data, function(d) {
                return d.average;
              }),
              buckets - 1,
              d3.max(data, function(d) {
                return d.average;
              })
            ])
            .range(colors);

          var textColorScale = d3.scale
            .quantile()
            .domain([
              d3.min(data, function(d) {
                return d.average;
              }),
              buckets - 1,
              d3.max(data, function(d) {
                return d.average;
              })
            ])
            .range(textColors);

          // double y axis translate
          var transform;
          d3.select("#chart")
            .select(".axis")
            .selectAll(".tick")
            .attr("transform", function() {
              transform = d3.transform(d3.select(this).attr("transform"));
              return (
                "translate(" +
                transform.translate[0] +
                "," +
                transform.translate[1] * 2 +
                ")"
              );
            });

          var cards = svg
            .selectAll(".column")
            .data(data, function(d) {
              return d.row + ":" + d.column + ":" + d.department;
            })
            .enter();

          cards
            .append("rect")
            .attr("x", function(d) {
              return (d.column - 1) * gridSize * 1.75;
            })
            .attr("y", function(d) {
              return (d.row - 1) * gridSize;
            })
            .attr("rx", 4)
            .attr("ry", 4)
            .attr("class", "column bordered")
            .attr("width", gridSize * 1.75)
            .attr("height", gridSize)
            .attr("cursor", "pointer")
            .attr("selected", function(d) {
              if (d.department == selectedDept) {
                click(d);
                return true;
              } else {
                return false;
              }
            })
            .style("fill", function(d) {
              if (d3.select(this).attr("selected") == "true") {
                return "#fb0";
              } else {
                return colorScale(d.average);
              }
            })
            .on("click", function(d) {
              selectedDept = d.department;

              d3.select("#chart")
                .selectAll("rect")
                .style("fill", function(d) {
                  return colorScale(d.average);
                })
                .selectAll("text")
                .style("fill", function(d) {
                  return textColorScale(d.average);
                });

              d3.select("#chart")
                .selectAll("rect")
                .attr("selected", false);
              d3.select(this)
                .attr("selected", true)
                .style("fill", "fb0");

              loadHelpfulReviews({ Category: "3#" });
              click(d);
            });

          cards
            .append("text")
            .attr("class", "column bordered")
            .attr("x", function(d) {
              return ((d.column - 1) * gridSize + gridSize / 2 - 20) * 1.75;
            })
            .attr("y", function(d) {
              return d.row * gridSize - (gridSize / 2 - 8);
            })
            .attr("cursor", "pointer")
            .style("fill", function(d) {
              return textColorScale(d.average);
            })
            .text(function(d) {
              return d.department.split("_")[0];
            })
            .on("click", function(d) {
              loadHelpfulReviews({ Category: "3#" });
            });
        });
      };

      var displayBarGraph = function(chartData) {
        var margin = {
          top: 15,
          right: 20,
          bottom: 15,
          left: 30
        };

        var width = 650,
          height = 300;

        d3.select("#graphic")
          .select("svg")
          .remove();

        var svg = d3
          .select("#graphic")
          .append("svg")
          .attr("width", width - margin.left - margin.right)
          .attr("height", height - margin.top - margin.bottom)
          .append("g")
          .attr(
            "transform",
            "translate(" + margin.left + "," + margin.top + ")"
          );

        var domainMax = Math.max.apply(
          Math,
          chartData.map(function(obj) {
            return obj.Average;
          })
        );
        domainMax = domainMax + domainMax / 3.75;

        var x = d3.scale
          .linear()
          .range([0, width])
          .domain([0, domainMax]);

        var y = d3.scale
          .ordinal()
          .rangeRoundBands([100, 0], 0.25)
          .domain(
            chartData.map(function(d) {
              return d.Category;
            })
          );

        //make y axis to show bar names
        var yAxis = d3.svg
          .axis()
          .scale(y)
          //no tick marks
          .tickSize(0)
          .orient("left");

        var gy = svg
          .append("g")
          .attr("class", "y axis")
          .call(yAxis);

        var bars = svg
          .selectAll(".graph")
          .data(chartData)
          .enter()
          .append("g");

        // double y axis translate
        var transform;
        d3.select("#graphic")
          .select(".axis")
          .selectAll(".tick")
          .attr("transform", function() {
            transform = d3.transform(d3.select(this).attr("transform"));
            return (
              "translate(" +
              transform.translate[0] +
              "," +
              transform.translate[1] * 2 +
              ")"
            );
          });

        //append rects
        bars
          .append("rect")
          .attr("class", "graph")
          .attr("cursor", "pointer")
          .attr("y", function(d) {
            return y(d.Category) * 2;
          })
          .attr("height", y.rangeBand() * 2)
          .attr("x", 0)
          .attr("width", 0)
          .transition()
          .delay(function(d, i) {
            return i * 100;
          })
          .attr("width", function(d) {
            return x(d.Average);
          });

        bars.on("click", function(d) {
          //document.getElementById('#more').innerText = "Read full Reviews";
          loadHelpfulReviews(d);
        });

        //add a value label to the right of each bar
        bars
          .append("text")
          .attr("class", "label")
          .attr("y", function(d) {
            return y(d.Category) * 2 + y.rangeBand() / 2 + 12;
          })
          .attr("x", 0)
          .transition()
          .delay(function(d, i) {
            return i * 100;
          })
          //x position is 3 pixels to the right of the bar
          .attr("x", function(d) {
            return x(d.Average) + 3;
          })

          .text(function(d) {
            if (selected == "Percentage") {
              return d.Average + "%";
            } else {
              return d.Average;
            }
          });
      };

      function click(d) {
        loadHelpfulReviews({ Category: "3#" });
        loadBubbleGraph(selectedDept);
        loadTimeSeries(jQuery, window.d3, window.moment, selectedDept);
        d3.select("#table")
          .select("table")
          .remove();

        var data = [
          ["Total Number of Reviews:", d.count],
          ["Average of Reviews:", d.average],
          ["Rank (total):", d.rank_total],
          ["Rank (average):", d.rank_average]
        ];

        //Bar Chart
        var chartData1 = [
          {
            Category: "5#",
            Average: d.Star5
          },
          {
            Category: "4#",
            Average: d.Star4
          },
          {
            Category: "3#",
            Average: d.Star3
          },
          {
            Category: "2#",
            Average: d.Star2
          },
          {
            Category: "1#",
            Average: d.Star1
          }
        ];

        var tot =
          parseInt(d.Star5) +
          parseInt(d.Star4) +
          parseInt(d.Star3) +
          parseInt(d.Star2) +
          parseInt(d.Star1);

        var chartData2 = [
          {
            Category: "5#",
            Average: ((d.Star5 * 100) / tot).toFixed(2)
          },
          {
            Category: "4#",
            Average: ((d.Star4 * 100) / tot).toFixed(2)
          },
          {
            Category: "3#",
            Average: ((d.Star3 * 100) / tot).toFixed(2)
          },
          {
            Category: "2#",
            Average: ((d.Star2 * 100) / tot).toFixed(2)
          },
          {
            Category: "1#",
            Average: ((d.Star1 * 100) / tot).toFixed(2)
          }
        ];

        var charts = [["Total", chartData1], ["Percentage", chartData2]];
        if (selected == "Total") {
          displayBarGraph(chartData1);
        } else {
          displayBarGraph(chartData2);
        }

        var setpicker = d3
          .select("#set-picker")
          .selectAll(".dataset-button")
          .data(charts);

        setpicker
          .enter()
          .append("input")
          .attr("value", function(d) {
            return d[0];
          })
          .attr("type", "button")
          .attr("class", "dataset-button highlight2")
          .on("click", function(d) {
            selected = d[0];
            displayBarGraph(d[1]);
            d3.select("#set-picker")
              .selectAll(".dataset-button")
              .attr("class", "dataset-button")
              .attr("style", "deselected");
            d3.select(this).style("background-color", "#fb0");
            d3.select(this).style("border", "none");
            d3.select(this).style("outline", "none");
          });

        //Table
        var table = d3
          .select("#table")
          .append("table")
          .attr("class", "table");

        var HeaderRow = table.append("tr");

        HeaderRow.append("th")
          .text(d.department)
          .attr("colspan", 2);

        var tr = table
          .selectAll("tr.data")
          .data(data)
          .enter()
          .append("tr")
          .attr("class", "datarow");

        tr.append("td")
          .attr("class", "data name")
          .text(function(d) {
            return d[0];
          });

        tr.append("td")
          .attr("class", "data value")
          .text(function(d) {
            return d[1];
          });
      }

      heatmapChart(dataset[1][1]);

      var datasetpicker = d3
        .select("#dataset-picker")
        .selectAll(".dataset-button")
        .data(dataset);

      datasetpicker
        .enter()
        .append("input")
        .attr("value", function(d) {
          return d[0];
        })
        .attr("type", "button")
        .attr("class", "dataset-button highlight")
        .on("click", function(d) {
          heatmapChart(d[1]);
          d3.select("#dataset-picker")
            .selectAll(".dataset-button")
            .attr("style", "deselected")
            .attr("class", "dataset-button");
          d3.select(this).style("background-color", "#fb0");
          d3.select(this).style("border", "none");
          d3.select(this).style("outline", "none");
        });
    </script>
    <script>
      var display_str = "";
      var display_div = document.getElementById("display_div_id");

      function incrementCount(current_count) {
        // clear count
        while (display_div.hasChildNodes()) {
          display_div.removeChild(display_div.lastChild);
        }

        display_str = current_count.toString();

        for (var i = 0; i < display_str.length; i++) {
          var new_span = document.createElement("span");
          new_span.className = "num_tiles";
          new_span.innerText = display_str[i];
          display_div.appendChild(new_span);
        }
      }
    </script>
  </body>
</html>
